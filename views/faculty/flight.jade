extends ../layout

block content
  section.content-header.oh
    h1.pull-left
      | #{course.name}&nbsp;&nbsp;
      a.text-yellow(href="/faculty/flights/#{course.abbr}/settings")
        i.fa.fa-pencil

  //- Main content
  section.content
    ul.timeline
      li.time-label.locked
        span.text-uppercase
          | Students
      if course.Students.length === 0
        li.timeline-item.locked
          i.fa
          .timeline-item
            h3.timeline-header No Students
      for student in course.Students
        li.timeline-item
          i.fa.fa-user
          .timeline-item
            h3.timeline-header
              | #{student.name}
              //- a.pull-right(href="/faculty/student/#{student.id}") View Progress
            .timeline-body
              .callout
                h4 Pending Missions
              .list-group
                - var missions = 0; var completed = 0;
                for level in student.StudentLevels
                  if level.Level.CourseId === course.id
                    - missions += level.to_complete

                for studentMission in student.StudentMissions
                  if studentMission.Level.CourseId === course.id
                    if studentMission.MissionStatusId === 4
                      - completed++
                      .list-group-item.complete
                        .list-group-item-heading.oh
                          h4.pull-left
                            | #{studentMission.Mission.name}
                    if studentMission.MissionStatusId === 3
                      .list-group-item.add.margin-top(mission-id="#{studentMission.Mission.id}")
                        .list-group-item-heading.oh
                          h4.pull-left
                            | #{studentMission.Mission.name}
                          .pull-right
                            a.btn.btn-reject(href="/faculty/flights/#{course.abbr}/mission/#{studentMission.id}/2") Reject
                            | &nbsp;
                            a.btn.btn-warning(href="/faculty/flights/#{course.abbr}/mission/#{studentMission.id}/4") Accept
                        .list-group-item-text
                          for comment in studentMission.Comments
                            include ../common/comment
                          form(action="/faculty/flights/#{course.abbr}/mission/#{studentMission.id}/comment",method="post").comment
                            h4 Add Comment
                            textarea.textarea(name="text", placeholder='Comment', style='width: 100%; height: 200px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;')
                            button.btn.btn-warning.timeline-btn.btn-block(type="submit") Send Comment
              h4 Progress
              .progress
                .progress-bar(style="width:#{completed/missions*100}%")
                  | #{completed} / #{missions}

  #newTerm.modal.fade(role="dialog")
    .modal-dialog
      form.modal-content(action="#{course.abbr}/term", method="POST")
        .modal-header
          button.close(type="button",data-dismiss="model")
            i.fa.fa-times
          h4.modal-title
            | New Term
        .modal-body
          .form-group
            label(for="name") Name
            input.form-control(type="text", id="name", name="name")

        .modal-footer
          button.btn.btn-warning(type="submit") Create Term

  script(type='text/javascript').
    $(function () {
      $("i[href]").on('click',function(){
        var icon = $(this)
        var link = icon.attr('href');
        $.get(link);
        icon.closest('li.timeline-item').remove();
      });
    });